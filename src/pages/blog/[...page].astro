---
import Layout from "~/layouts/PageLayout.astro";
import { SITE } from "~/config.mjs";
import { fetchPosts } from "~/utils/fetchPosts.js";
import BlogList from "~/components/widgets/BlogList.astro";

interface PaginateFunction<T> {
  (data: T[], options: { pageSize: number }): {
    data: T[];
    totalPages: number;
  };
}

export async function getStaticPaths({ paginate }: { paginate: PaginateFunction<any> }) {
  const posts = await fetchPosts();
  return paginate(posts, {
    pageSize: SITE.postsPerPage,
  });
}

const { page } = Astro.props;
const currentPage = page.currentPage ?? 1;
const title = `Blog ${currentPage > 1 ? `— Page ${currentPage} ` : ""}— ${SITE.name}`;
const description = SITE.description;
const canonical = new URL(page.url.current, Astro.site);
---

<Layout meta={{ title, description, canonical }}>
  <BlogList page={page} />
</Layout>